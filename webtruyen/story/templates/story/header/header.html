{% load static %}

<link
  href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Inter:wght@400;500;600&display=swap"
  rel="stylesheet"
/>
<script src="https://cdn.tailwindcss.com"></script>
<script>
  (function () {
    try {
      const theme = localStorage.getItem("theme");
      if (theme === "light") {
        document.documentElement.classList.add("light-mode");
      }
    } catch (e) {}
  })();
  tailwind.config = {
    theme: {
      extend: {
        colors: { primary: "#EAB308" },
        fontFamily: {
          logo: ['"Dancing Script"', "cursive"],
          sans: ["Inter", "sans-serif"],
        },
      },
    },
  };
</script>

<style>
  /* --- TR·∫†NG TH√ÅI M·∫∂C ƒê·ªäNH (DARK MODE) --- */
  body {
    background-color: #121212;
    color: #eeeeee;
    transition:
      background-color 0.3s,
      color 0.3s;
  }

  #main-header {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .search-input {
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.3s ease;
  }

  /* Dropdown Logic */
  .dropdown-menu {
    opacity: 0;
    visibility: hidden;
    transform: translateY(15px);
    transition: all 0.3s ease;
    pointer-events: none;
  }

  .group:hover .dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
    pointer-events: auto;
  }

  .nav-link {
    position: relative;
    transition: all 0.3s ease;
  }

  .nav-link.active {
    color: #eab308 !important;
    font-weight: 600;
  }

  .nav-link.active::after {
    content: "";
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: #eab308;
    border-radius: 2px;
  }

  /* --- CH·∫æ ƒê·ªò S√ÅNG (LIGHT MODE) --- */
  html.light-mode body {
    background-color: #ffffff !important;
    color: #000000 !important;
  }

  /* Chuy·ªÉn T·∫§T C·∫¢ ch·ªØ sang m√†u ƒëen (tr·ª´ m√†u primary) */
  html.light-mode body :not(.text-primary):not(.dropdown-content *) {
    color: #000000;
  }

  /* Tinh ch·ªânh Header & Nav trong Light Mode */
  html.light-mode body .nav-link,
  html.light-mode body #header-inner a:not(.text-primary) {
    color: #1a1a1a !important;
  }

  html.light-mode body .search-input {
    background: #f3f4f6 !important;
    border: 1px solid #d1d5db !important;
    color: #000000 !important;
  }

  html.light-mode body .search-input::placeholder {
    color: #6b7280 !important;
  }

  /* Dropdown trong ch·∫ø ƒë·ªô s√°ng */
  html.light-mode body .dropdown-content {
    background-color: #ffffff !important;
    border-color: #e5e7eb !important;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  }

  html.light-mode body .dropdown-content a {
    color: #374151 !important;
  }

  html.light-mode body .dropdown-content a:hover {
    background-color: #f3f4f6;
    color: #eab308 !important;
  }

  /* Hi·ªÉn th·ªã Menu S√°ng/T·ªëi */
  #theme-menu-container.show #theme-menu {
    display: block !important;
  }
  html.preload * {
    transition: none !important;
  }
</style>

<header
  id="main-header"
  class="fixed top-0 left-0 w-full z-[1000] bg-transparent"
>
  <div
    id="header-inner"
    class="container mx-auto px-4 py-5 flex justify-between items-center transition-all duration-300"
  >
    <div class="flex items-center">
      <a
        href="/"
        class="text-3xl font-logo text-primary hover:scale-105 transition-transform"
        >Nguy·ªát M·ªông Th∆∞</a
      >
    </div>

    <nav class="hidden md:flex items-center space-x-10">
      <a
        href="/"
        class="nav-link hover:text-primary transition font-medium {% if request.path == '/' %}active{% endif %}"
        >Trang ch·ªß</a
      >
      <a
        href="/stories/"
        class="nav-link hover:text-primary transition font-medium {% if '/stories/' in request.path %}active{% endif %}"
        >Truy·ªán</a
      >

      <div class="relative group">
        <button
          class="nav-link flex items-center group-hover:text-primary transition font-medium outline-none py-5 {% if '/categories/' in request.path or '/category/' in request.path %}active{% endif %}"
        >
          Th·ªÉ lo·∫°i
          <svg
            class="w-4 h-4 ml-1 mt-0.5 transition-transform group-hover:rotate-180"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M19 9l-7 7-7-7"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            ></path>
          </svg>
        </button>

        <div
          class="dropdown-menu absolute left-1/2 -translate-x-1/2 w-[550px] lg:w-[650px] pt-1"
        >
          <div
            class="dropdown-content bg-[#1a1a1a] border border-[#333] rounded-xl shadow-2xl overflow-hidden mt-1"
          >
            <div class="grid grid-cols-3 gap-x-2 gap-y-1 p-5">
              {% for cat in categories %}
              <a
                href="{% url 'category_detail' cat.slug %}"
                class="group/item flex items-center justify-between px-3 py-2 text-[14px] hover:bg-white/5 hover:text-primary rounded-lg transition-all"
              >
                <span>{{ cat.category_name }}</span>
                {% if cat.story_count %}<span
                  class="text-[10px] text-gray-500 group-hover/item:text-primary/70"
                  >({{cat.story_count}})</span
                >
                {%endif %}
              </a>
              {% endfor %}
            </div>
            <div class="bg-white/5 p-3 text-center border-t border-[#333]">
              <a
                href="{% url 'categories' %}"
                class="text-[11px] text-primary hover:text-yellow-400 uppercase tracking-widest font-bold transition"
                >T·∫•t c·∫£ th·ªÉ lo·∫°i</a
              >
            </div>
          </div>
        </div>
      </div>

      <a
        href="/contact/"
        class="nav-link hover:text-primary transition font-medium {% if request.path == '/contact/' %}active{% endif %}"
        >Li√™n h·ªá</a
      >
    </nav>

    <div class="flex items-center space-x-5">
      <div class="relative hidden sm:block">
        <form action="/search/" method="GET">
          <input
            type="text"
            name="q"
            placeholder="T√¨m ki·∫øm..."
            class="search-input w-48 lg:w-60 px-4 py-1.5 text-sm rounded-md text-white placeholder-gray-400"
          />
        </form>
      </div>

      <div class="flex items-center space-x-5">
        <div
          onclick="toggleTheme()"
          class="text-gray-400 hover:text-primary cursor-pointer flex items-center py-2 px-3 transition"
        >
          <svg
            id="mode-icon"
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <!-- icon s·∫Ω ƒë∆∞·ª£c JS set -->
          </svg>
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  function toggleTheme() {
    const html = document.documentElement;
    const isLight = html.classList.toggle("light-mode");

    localStorage.setItem("theme", isLight ? "light" : "dark");
    setThemeIcon(isLight);
    updateHeaderStyle();
  }

  function setThemeIcon(isLight) {
    const icon = document.getElementById("mode-icon");

    if (isLight) {
      // ‚òÄÔ∏è icon
      icon.innerHTML = `
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 3v1m0 16v1m9-9h-1M4 12H3
                    m15.364-6.364l-.707.707M6.343 17.657l-.707.707
                    m12.728 0l-.707-.707M6.343 6.343l-.707-.707
                    M12 8a4 4 0 100 8 4 4 0 000-8z"/>
            `;
    } else {
      // üåô icon
      icon.innerHTML = `
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M20.354 15.354A9 9 0 018.646 3.646
                    9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
            `;
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    const theme = localStorage.getItem("theme");
    const isLight = theme === "light";

    if (isLight) {
      document.body.classList.add("light-mode");
    }

    setThemeIcon(isLight);
    updateHeaderStyle();
  });
  document.documentElement.classList.add("preload");

  window.addEventListener("load", () => {
    document.documentElement.classList.remove("preload");
  });
</script>
