{% load static %}
 {% load i18n %}<header id="main-header" class="fixed top-0 left-0 w-full z-[1000] transition-all duration-300">
  <div id="header-inner" class="container mx-auto px-4 h-[70px] flex justify-between items-center">

    <div class="flex-shrink-0">
      <a href="/" class="text-3xl font-logo text-primary tracking-wide hover:scale-105 transition-transform block">
        Thiên Mộng Hành
      </a>
    </div>

    <nav class="hidden md:flex items-center space-x-8 text-[15px] font-medium">
      <a href="/" class="nav-link hover:text-primary transition-colors">Trang chủ</a>
      <a href="/stories/" class="nav-link hover:text-primary transition-colors">Truyện</a>

      <div class="relative group">
        <button class="nav-link flex items-center group-hover:text-primary font-medium outline-none py-5">
          Thể loại
          <svg class="w-4 h-4 ml-1 mt-0.5 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor"
            viewBox="0 0 24 24">
            <path d="M19 9l-7 7-7-7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          </svg>
        </button>
        <div
          class="dropdown-menu absolute left-1/2 -translate-x-1/2 w-[550px] lg:w-[650px] pt-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300">
          <div
            class="dropdown-content border border-white/10 rounded-xl shadow-2xl overflow-hidden mt-1 backdrop-blur-md bg-[#121212]/95">
            <div class="grid grid-cols-3 gap-x-2 gap-y-1 p-5">
              {% for cat in categories %}
              <a href="{% url 'category_detail' cat.slug %}"
                class="flex items-center justify-between px-3 py-2 text-[14px] text-gray-300 hover:bg-white/5 hover:text-primary rounded-lg transition-colors">
                <span class="font-medium">{{ cat.category_name }}</span>
                {% if cat.story_count %}
                <span class="text-[10px] text-gray-500">({{ cat.story_count }})</span>
                {% endif %}
              </a>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>

      <a href="/contact/" class="nav-link hover:text-primary transition-colors">Liên hệ</a>
    </nav>

    <div class="flex items-center space-x-3">

      <div class="hidden md:block relative">
        <form action="{% url 'search_results' %}" method="GET">
          <input type="text" name="q" value="{{ query|default:'' }}" placeholder="Tìm kiếm truyện..."
            class="bg-[#1a1a1a]/60 border border-gray-700/50 text-gray-200 text-sm rounded-full px-4 py-1.5 w-[180px] lg:w-[220px] focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary transition-all" />
        </form>
      </div>

      <button onclick="toggleTheme()" class="p-2 text-gray-400 hover:text-primary transition-colors focus:outline-none">
        <svg id="mode-icon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"></svg>
      </button>

      <div class="flex items-center border-l border-gray-700/50 pl-3 ml-1 space-x-3">
        {% if user.is_authenticated %}
        <div class="relative group">
          <button class="flex items-center space-x-2 focus:outline-none py-2">
            <div
              class="w-8 h-8 rounded-full bg-primary/20 border border-primary/50 flex items-center justify-center text-primary font-bold text-sm uppercase">
              {{ user.username|slice:":1" }}
            </div>
            <span class="hidden lg:block text-sm text-gray-500 font-medium group-hover:text-primary transition-colors">
              {{ user.username }}
            </span>
          </button>

          <div class="absolute right-0 w-48 pt-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300">
    <div class="user-dropdown-container border rounded-xl shadow-2xl overflow-hidden mt-1 backdrop-blur-md p-1 transition-all">

        <a href="{% url 'profile' %}" class="dropdown-item-link flex items-center gap-2 px-4 py-2.5 text-sm rounded-lg transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" stroke-width="2"></path>
            </svg>
            <span>Trang cá nhân</span>
        </a>

        <a href="{% url 'profile' %}?tab=history" class="dropdown-item-link flex items-center gap-2 px-4 py-2.5 text-sm rounded-lg transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <span>Lịch sử đọc</span>
        </a>

        <a href="{% url 'profile' %}?tab=favorite" class="dropdown-item-link flex items-center gap-2 px-4 py-2.5 text-sm rounded-lg transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            <span>Truyện yêu thích</span>
        </a>

        <div class="dropdown-divider my-1 border-t"></div>

        <form action="{% url 'logout' %}" method="post">
            {% csrf_token %}
            <button type="submit" class="dropdown-item-logout w-full flex items-center gap-2 px-4 py-2.5 text-sm rounded-lg transition-colors text-red-400 hover:bg-red-500/10">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" stroke-width="2"></path>
                </svg>
                <span>Đăng xuất</span>
            </button>
        </form>
    </div>
</div>
        </div>
        {% else %}
        <div class="flex items-center space-x-4">
          <a href="{% url 'login' %}"
            class="text-sm font-medium text-gray-500 hover:text-primary transition-colors">Đăng nhập</a>
          <a href="{% url 'register' %}"
            class="hidden sm:block px-5 py-1.5 bg-primary hover:bg-yellow-600 text-black text-sm font-bold rounded-full transition-all shadow-lg shadow-primary/20">
            Đăng ký
          </a>
        </div>
        {% endif %}
      </div>
<form action="{% url 'set_language' %}" method="post" class="flex gap-2">
    {% csrf_token %}
    <input name="next" type="hidden" value="{{ request.get_full_path }}">
    <select name="language" onchange="this.form.submit()" class="bg-transparent text-gray-400 text-xs border border-gray-700 rounded px-1">
        <option value="vi" {% if request.LANGUAGE_CODE == 'vi' %}selected{% endif %}>VI</option>
        <option value="en" {% if request.LANGUAGE_CODE == 'en' %}selected{% endif %}>EN</option>
        <option value="zh-hans" {% if request.LANGUAGE_CODE == 'zh-hans' %}selected{% endif %}>CN</option>
    </select>
</form>
      <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-gray-500 hover:text-white focus:outline-none">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>

    </div>
  </div>
</header>

<div id="mobile-menu"
  class="fixed inset-0 bg-[#121212] z-[2000] transform translate-x-full transition-transform duration-300 md:hidden">
  <div class="p-6 h-full flex flex-col">
    <div class="flex justify-between items-center mb-10">
      <h2 class="text-2xl font-logo text-primary">Thiên Mộng Hành</h2>
      <button onclick="toggleMobileMenu()" class="text-gray-400">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <nav class="flex flex-col space-y-6 text-lg flex-grow overflow-y-auto">
      <a href="/" class="text-primary font-bold">Trang chủ</a>
      <a href="/stories/" class="text-gray-300">Truyện</a>

      <div>
        <button onclick="toggleCategory()" class="flex justify-between w-full text-gray-300">
          <span>Thể loại</span>
          <svg id="cat-icon" class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"
            stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
          </svg>
        </button>
        <div id="mobile-category-list" class="hidden mt-4 grid grid-cols-2 gap-3 bg-white/5 rounded-xl p-4">
          {% for cat in categories %}
          <a href="{% url 'category_detail' cat.slug %}" class="text-sm text-gray-400 hover:text-primary">
            {{ cat.category_name }}
          </a>
          {% endfor %}
        </div>
      </div>

      <a href="/contact/" class="text-gray-300">Liên hệ</a>
    </nav>

    <div class="pt-6 mt-6 border-t border-white/10">
      {% if user.is_authenticated %}
      <a href="{% url 'profile' %}" class="flex items-center space-x-3 mb-6">
        <div
          class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold uppercase">
          {{ user.username|slice:":1" }}
        </div>
        <span class="text-white font-medium">{{ user.username }} (Hồ sơ)</span>
      </a>
      <form action="{% url 'logout' %}" method="post">
        {% csrf_token %}
        <button type="submit" class="w-full py-3 bg-red-500/10 text-red-400 font-bold rounded-xl">Đăng xuất</button>
      </form>
      {% else %}
      <div class="grid grid-cols-2 gap-4">
        <a href="{% url 'login' %}"
          class="flex items-center justify-center py-3 border border-gray-700 text-white font-bold rounded-xl">Đăng
          nhập</a>
        <a href="{% url 'register' %}"
          class="flex items-center justify-center py-3 bg-primary text-black font-bold rounded-xl">Đăng ký</a>
      </div>
      {% endif %}
    </div>
  </div>
</div>

<script src="{% static 'story/js/header.js' %}"></script>