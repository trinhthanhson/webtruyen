<!-- Story Detail Page - Dark Mode Theme -->

<!-- Load Tailwind CSS CDN -->
{% load static %}

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="{% static 'story/css/style.css' %}?v=1.0">
<link rel="stylesheet" href="{% static 'story/css/banner/banner.css' %}?v=1.0">
<script>
    // Custom Tailwind Configuration (Configuring dark mode colors)
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    'primary': '#3b82f6', // Blue-500: Nổi bật, dùng cho CTA chính
                    'secondary': '#f97316', // Orange-500: Dùng cho CTA phụ/cần chú ý
                    'dark-bg-body': '#171717', // Màu nền sâu hơn (Neutral-900)
                    'dark-bg-card': '#262626', // Màu nền container (Neutral-800)
                },
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                },
            }
        }
    }
</script>

<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Sử dụng một tiêu đề giả định cho mục đích xem trước -->
    <title>{{ story.title|default:"Tên Truyện Đang Tải..." }}</title>
</head>

<!-- Body sử dụng màu nền tối sâu và màu chữ sáng -->

<body class="bg-dark-bg-body font-sans antialiased text-gray-100 min-h-screen flex flex-col">

    {% include 'story/header/header.html' %}


    <!-- Main Content: Story Detail -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-7xl">

        <!-- 1. THÔNG TIN TRUYỆN VÀ TÓM TẮT -->
        <!-- Thẻ cha dùng màu nền card tối, bo tròn và bóng nổi bật -->
        <div class="bg-dark-bg-card rounded-2xl shadow-2xl p-6 md:p-8 mb-10 border border-gray-700/50">
            <div class="flex flex-col md:flex-row gap-8">

                <!-- Hình ảnh bìa truyện -->
                <div class="w-full md:w-1/3 lg:w-1/4 flex-shrink-0">
                    <!-- aspect-[3/4] đảm bảo tỉ lệ ảnh đứng -->
                    <img src="{{ story.cover_image_url }}" alt="Bìa truyện {{ story.title|default:'Truyện' }}"
                        onerror="this.onerror=null; this.src='https://placehold.co/300x400/374151/D1D5DB?text=Kh%C3%B4ng+%E1%BA%A2nh'"
                        class="w-full h-auto object-cover rounded-xl shadow-xl transition-all duration-300 hover:shadow-primary/50 aspect-[3/4]">
                </div>

                <!-- Tóm tắt và Metadata -->
                <div class="w-full md:w-2/3 lg:w-3/4">
                    <!-- Tiêu đề truyện -->
                    <h1 class="text-3xl md:text-5xl font-extrabold text-white mb-3 leading-tight">
                        {{ story.title|default:"Tiêu Đề Truyện Chưa Tải" }}
                    </h1>

                    <p class="text-gray-400 mb-4 text-lg">
                        <span class="font-semibold text-gray-300">Tác giả:</span>
                        <a href="{% url 'search' %}?q={{ story.author }}"
                            class="text-primary hover:text-blue-400 font-medium transition cursor-pointer">
                            {{ story.author|default:"Ẩn Danh" }}
                        </a>
                    </p>

                    <div class="flex flex-wrap gap-2 mb-6 text-sm">
                        {% for category in story.categories.all %}
                        {% if forloop.counter|divisibleby:6 %}
                        <a href="{% url 'category_detail' category.slug %}"
                            class="bg-indigo-600 text-white px-3 py-1 rounded-full font-medium shadow-md hover:opacity-90 transition">
                            {{ category.category_name }}
                        </a>
                        {% elif forloop.counter|divisibleby:5 %}
                        <a href="{% url 'category_detail' category.slug %}"
                            class="bg-green-600 text-white px-3 py-1 rounded-full font-medium shadow-md hover:opacity-90 transition">
                            {{ category.category_name }}
                        </a>
                        {% elif forloop.counter|divisibleby:4 %}
                        <a href="{% url 'category_detail' category.slug %}"
                            class="bg-yellow-600 text-white px-3 py-1 rounded-full font-medium shadow-md hover:opacity-90 transition">
                            {{ category.category_name }}
                        </a>
                        {% elif forloop.counter|divisibleby:3 %}
                        <a href="{% url 'category_detail' category.slug %}"
                            class="bg-red-600 text-white px-3 py-1 rounded-full font-medium shadow-md hover:opacity-90 transition">
                            {{ category.category_name }}
                        </a>
                        {% elif forloop.counter|divisibleby:2 %}
                        <a href="{% url 'category_detail' category.slug %}"
                            class="bg-pink-600 text-white px-3 py-1 rounded-full font-medium shadow-md hover:opacity-90 transition">
                            {{ category.category_name }}
                        </a>
                        {% else %}
                        <a href="{% url 'category_detail' category.slug %}"
                            class="bg-purple-600 text-white px-3 py-1 rounded-full font-medium shadow-md hover:opacity-90 transition">
                            {{ category.category_name }}
                        </a>
                        {% endif %}
                        {% empty %}
                        <span class="bg-gray-500 text-white px-3 py-1 rounded-full font-medium shadow-md">
                            Chưa có thể loại
                        </span>
                        {% endfor %}
                    </div>




                    <!-- Tóm tắt truyện -->
                    <h3 class="text-xl font-bold text-gray-200 mb-2 border-b border-gray-700 pb-1">Tóm tắt</h3>
                    <p class="text-gray-400 text-base leading-relaxed mb-6 max-h-36 overflow-hidden relative">
                        {{story.description}}
                        <!-- Thêm hiệu ứng fade-out cho tóm tắt dài -->
                    <div class="absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-dark-bg-card to-transparent">
                    </div>
                    </p>

                    <!-- Nút Đọc Chương Mới Nhất / Chương Đầu Tiên -->
                    <div class="mt-6 flex flex-col sm:flex-row gap-4">

                        <!-- 1️⃣ Nút ĐỌC TỪ ĐẦU -->
                        {% if story.first_chapter_number %}
                        <a href="{% url 'chapter_detail' story_slug=story.slug chapter_number=story.first_chapter_number|floatformat:0 %}"
                            class="flex-1 text-center bg-primary text-white font-extrabold py-3 px-6 rounded-xl shadow-xl shadow-primary/30 
                            hover:bg-blue-600 hover:shadow-primary/50 transition duration-300 transform hover:scale-[1.02]">
                            <i class="fas fa-book-open mr-2"></i> ĐỌC TỪ ĐẦU
                        </a>
                        {% else %}
                        <button disabled class="flex-1 text-center bg-gray-400 text-gray-200 font-extrabold py-3 px-6 rounded-xl shadow-inner 
                                cursor-not-allowed">
                            <i class="fas fa-book-open mr-2"></i> ĐỌC TỪ ĐẦU
                        </button>
                        {% endif %}

                        <!-- 2️⃣ Nút CHƯƠNG MỚI NHẤT -->
                        {% if story.latest_chapter_number %}
                        <a href="{% url 'chapter_detail' story_slug=story.slug chapter_number=story.latest_chapter_number|floatformat:0 %}"
                            class="flex-1 text-center bg-secondary text-white font-extrabold py-3 px-6 rounded-xl shadow-xl shadow-secondary/30 
                            hover:bg-orange-600 hover:shadow-secondary/50 transition duration-300 transform hover:scale-[1.02]">
                            <i class="fas fa-arrow-right mr-2"></i> CHƯƠNG MỚI NHẤT
                        </a>
                        {% else %}
                        <button disabled class="flex-1 text-center bg-gray-400 text-gray-200 font-extrabold py-3 px-6 rounded-xl shadow-inner 
                                cursor-not-allowed">
                            <i class="fas fa-arrow-right mr-2"></i> CHƯƠNG MỚI NHẤT
                        </button>
                        {% endif %}

                    </div>


                </div>
            </div>
        </div>

        <!-- 2. DANH SÁCH CHƯƠNG -->
        <div class="bg-dark-bg-card rounded-2xl shadow-2xl p-6 md:p-8 border border-gray-700/50">
            <h3 class="text-2xl font-bold text-gray-200 mb-4 border-b border-gray-700 pb-2">Danh sách chương
            </h3>

            <!-- Grid cho bố cục 2 cột trên desktop -->
            <ul class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 divide-y sm:divide-y-0 divide-gray-700">
                {% if chapters %}
                {% for chapter in chapters %}
                <li class="py-3 hover:bg-neutral-700 transition duration-150 px-2 rounded-lg">
                    <a href="{% url 'chapter_detail' story_slug=story.slug chapter_number=chapter.chapter_number|floatformat:0 %}"
                        class="flex justify-between items-center text-gray-300 hover:text-primary">
                        <span class="truncate pr-4 font-medium">
                            <span class="text-primary font-bold mr-2 w-10 inline-block text-left">
                                C{{ chapter.chapter_number|floatformat:0 }}
                            </span>
                            {{ chapter.title }}
                        </span>
                        {% if chapter.published_at %}
                        <span class="text-sm text-gray-500 whitespace-nowrap hidden sm:block">
                            {{ chapter.published_at|date:"d-m-Y" }}
                        </span>
                        {% endif %}
                    </a>
                </li>
                {% endfor %}
                {% else %}
                {% for chapter in fake_chapters %}
                <li class="py-3 hover:bg-neutral-700 transition duration-150 px-2 rounded-lg">
                    <div class="flex justify-between items-center text-gray-400">
                        <span class="truncate pr-4 font-medium">
                            <span class="text-primary font-bold mr-2 w-10 inline-block text-left">
                                C{{ chapter.chapter_number }}
                            </span>
                            {{ chapter.title }}
                        </span>
                        <span class="text-sm text-gray-500 whitespace-nowrap hidden sm:block">
                            25-10-2025
                        </span>
                    </div>
                </li>
                {% endfor %}
                {% endif %}
            </ul>

            {% if not chapters %}
            <p class="text-center text-gray-500 py-8">Truyện này hiện chưa có chương nào.</p>
            {% endif %}
        </div>

    </main>

    {% include 'story/footer/footer.html' %}


</body>

</html>