{% load static %}
<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üìö Nguy·ªát M·ªông Th∆∞ - Trang ch·ªß</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#EAB308",
              bodybg: "#121212",
            },
            fontFamily: {
              logo: ['"Dancing Script"', "cursive"],
              sans: ["Inter", "sans-serif"],
            },
          },
        },
      };
    </script>

    <style>
      :root {
        --nmt-body-bg: #121212;
      }

      #global-bg-blur {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background-size: cover;
        background-position: center;
        filter: blur(30px) brightness(0.5) saturate(1.3);
        z-index: -2;
        transform: scale(1.1);
        /* T·ªëc ƒë·ªô chuy·ªÉn n·ªÅn 0.6s kh·ªõp v·ªõi speed c·ªßa Swiper */
        transition: background-image 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        will-change: background-image;
      }

      /* Hi·ªáu ·ª©ng ch·ªØ l∆∞·ªõt ƒë·ªìng b·ªô */
      #active-title,
      #active-description {
        transition:
          opacity 0.4s ease,
          transform 0.4s ease;
        will-change: opacity, transform;
      }

      .global-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.15);
        z-index: -1;
      }

      html,
      body,
      main,
      section,
      div {
        background-color: transparent !important;
      }

      .dropdown-content {
        background-color: var(--nmt-body-bg) !important;
        backdrop-filter: blur(20px);
      }

      #main-header {
        transition: all 0.3s ease;
      }
      .banner-container {
        padding-top: 140px;
        min-height: 60vh;
      }

      .story-card-link {
        display: block;
        background: rgba(255, 255, 255, 0.07) !important;
        backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 10px;
        transition: all 0.4s ease;
      }

      .story-card-link:hover {
        background: rgba(255, 255, 255, 0.15) !important;
        border-color: #eab308;
        transform: translateY(-8px);
      }

      .swiper {
        width: 260px;
        height: 380px;
        right: 50px;
      }
      .swiper-slide {
        border-radius: 12px;
        overflow: hidden;
      }
      .swiper-slide img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      #active-title {
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        color: rgb(245, 199, 74);
      }

      /* Ch·∫ø ƒë·ªô s√°ng */
      body.light-mode #global-bg-blur {
        filter: blur(30px) brightness(1.1) saturate(1.1);
      }
      body.light-mode .global-overlay {
        background: rgba(255, 255, 255, 0.7);
      }
      body.light-mode .text-gray-100 {
        color: #374151 !important;
      }
    </style>
  </head>

  <body class="text-white antialiased">
    <div id="global-bg-blur"></div>
    <div class="global-overlay"></div>

    <header
      id="main-header"
      class="fixed top-0 left-0 w-full z-[100] transition-all duration-300"
    >
      <div
        class="container mx-auto px-6 h-[64px] flex justify-between items-center"
      >
        <div class="flex-shrink-0">
          <a href="/" class="text-2xl font-logo text-primary tracking-wide"
            >Nguy·ªát M·ªông Th∆∞</a
          >
        </div>
        <nav
          class="hidden md:flex items-center space-x-8 text-[15px] font-medium"
        >
          <a href="/" class="text-primary border-b-2 border-primary pb-1"
            >Trang ch·ªß</a
          >
          <a
            href="/stories/"
            class="text-gray-200 hover:text-primary transition"
            >Truy·ªán</a
          >
          <div class="relative group">
            <button
              class="nav-link flex items-center text-gray-200 group-hover:text-primary transition font-medium outline-none py-5"
            >
              Th·ªÉ lo·∫°i
              <svg
                class="w-4 h-4 ml-1 mt-0.5 transition-transform group-hover:rotate-180"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M19 9l-7 7-7-7"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                ></path>
              </svg>
            </button>
            <div
              class="dropdown-menu absolute left-1/2 -translate-x-1/2 w-[550px] lg:w-[650px] pt-1 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300"
            >
              <div
                class="dropdown-content bg-bodybg border border-white/10 rounded-xl shadow-2xl overflow-hidden mt-1 backdrop-blur-md"
              >
                <div class="grid grid-cols-3 gap-x-2 gap-y-1 p-5">
                  {% for cat in categories %}
                  <a
                    href="{% url 'category_detail' cat.slug %}"
                    class="flex items-center justify-between px-3 py-2 text-[14px] text-gray-300 hover:bg-white/5 hover:text-primary rounded-lg transition"
                  >
                    <span class="font-medium">{{ cat.category_name }}</span>
                    {% if cat.story_count %}<span
                      class="text-[10px] text-gray-500"
                      >( {{cat.story_count }} )</span
                    >{% endif %}
                  </a>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
          <a href="#" class="text-gray-200 hover:text-primary transition"
            >Li√™n h·ªá</a
          >
        </nav>

        <div class="flex items-center space-x-4">
          <input
            type="text"
            placeholder="T√¨m ki·∫øm..."
            class="bg-[#1a1a1a]/60 border border-gray-700/50 text-gray-200 text-sm rounded-md px-4 py-1.5 w-[200px] focus:outline-none focus:border-primary transition"
          />
          <button
            onclick="toggleTheme()"
            class="text-gray-400 hover:text-primary"
          >
            <svg
              id="current-mode-icon"
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            ></svg>
          </button>
        </div>
      </div>
    </header>

    <section class="banner-container">
      <div
        class="container mx-auto px-6 flex flex-col md:flex-row items-center gap-12"
      >
        <div class="flex-1 text-center md:text-left">
          <a href="#" id="active-title-link" class="inline-block group">
            <h2
              id="active-title"
              class="text-5xl font-bold mb-6 leading-tight group-hover:text-primary transition duration-300"
            ></h2>
          </a>
          <p
            id="active-description"
            class="text-gray-100 text-lg mb-10 line-clamp-3"
          ></p>
          <a
            href="#"
            id="active-readmore-link"
            class="inline-block bg-white text-black px-10 py-4 rounded-xl font-bold hover:bg-primary hover:text-white transition shadow-lg"
            >ƒê·ªçc Ngay</a
          >
        </div>

        <div class="swiper mySwiper">
          <div class="swiper-wrapper">
            {% for story in stories %}
            <div
              class="swiper-slide"
              data-title="{{ story.title }}"
              data-desc="{{ story.description }}"
              data-url="{% url 'story_detail' story.slug %}"
            >
              <img src="{{ story.cover_image_url }}" alt="{{ story.title }}" />
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </section>

    <main class="container mx-auto px-6 py-20">
      <h2 class="text-3xl font-bold mb-10 flex items-center gap-3">
        <span class="w-1.5 h-8 bg-primary rounded-full"></span>Truy·ªán M·ªõi C·∫≠p
        Nh·∫≠t
      </h2>
      <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-8">
        {% for story in stories %}
        <a
          href="{% url 'story_detail' story.slug %}"
          class="story-card-link group"
        >
          <div class="aspect-[3/4] overflow-hidden rounded-lg mb-4 shadow-md">
            <img
              src="{{ story.cover_image_url }}"
              class="w-full h-full object-cover group-hover:scale-110 transition duration-500"
            />
          </div>
          <h3
            class="font-bold text-sm line-clamp-1 group-hover:text-primary transition"
          >
            {{ story.title }}
          </h3>
          <p class="text-[11px] text-gray-300 mt-1 opacity-80">
            {{ story.author }}
          </p>
        </a>
        {% endfor %}
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
      const titleEl = document.getElementById("active-title");
      const descEl = document.getElementById("active-description");
      const bgBlurEl = document.getElementById("global-bg-blur");

      var swiper = new Swiper(".mySwiper", {
        effect: "cards",
        grabCursor: true,
        rewind: true,
        speed: 600,
        autoplay: { delay: 4500, disableOnInteraction: true },
        on: {
          init: function () {
            syncBanner(this);
          },
          // S·ª¨A T·∫†I ƒê√ÇY: slideChange k√≠ch ho·∫°t ngay khi b·∫Øt ƒë·∫ßu chuy·ªÉn slide
          slideChange: function () {
            // Hi·ªáu ·ª©ng Fade out n·ªôi dung c≈© nhanh
            titleEl.style.opacity = "0";
            titleEl.style.transform = "translateY(10px)";
            descEl.style.opacity = "0";

            // ƒê·ªìng b·ªô d·ªØ li·ªáu ngay l·∫≠p t·ª©c kh√¥ng d√πng setTimeout
            syncBanner(this);

            // Hi·ªáu ·ª©ng Fade in n·ªôi dung m·ªõi ngay l·∫≠p t·ª©c
            requestAnimationFrame(() => {
              titleEl.style.opacity = "1";
              titleEl.style.transform = "translateY(0)";
              descEl.style.opacity = "1";
            });
          },
        },
      });

      function syncBanner(s) {
        const slide = s.slides[s.activeIndex];
        if (!slide) return;

        const data = slide.dataset;
        const imgPath = slide.querySelector("img").src;

        // Thay n·ªÅn v√† n·ªôi dung ƒë·ªìng b·ªô v·ªõi t·ªëc ƒë·ªô l∆∞·ªõt Card
        bgBlurEl.style.backgroundImage = `url('${imgPath}')`;
        titleEl.innerText = data.title;
        descEl.innerText = data.desc;

        const url = data.url;
        document.getElementById("active-title-link").href = url;
        document.getElementById("active-readmore-link").href = url;
      }

      window.addEventListener("scroll", function () {
        const header = document.getElementById("main-header");
        if (window.scrollY > 50) {
          header.style.backgroundColor = "rgba(18, 18, 18, 0.95)";
          header.style.backdropFilter = "blur(10px)";
        } else {
          header.style.backgroundColor = "transparent";
          header.style.backdropFilter = "blur(0px)";
        }
      });
      function setTheme(mode) {
        const body = document.body;
        const icon = document.getElementById("current-mode-icon");

        if (mode === "light") {
          body.classList.add("light-mode");
          localStorage.setItem("theme", "light");

          // Icon m·∫∑t tr·ªùi
          icon.innerHTML = `
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M12 3v1m0 16v1m9-9h-1M4 12H3
           m15.364-6.364l-.707.707M6.343 17.657l-.707.707
           m12.728 0l-.707-.707M6.343 6.343l-.707-.707
           M12 8a4 4 0 100 8 4 4 0 000-8z" />
    `;
        } else {
          body.classList.remove("light-mode");
          localStorage.setItem("theme", "dark");

          // Icon m·∫∑t trƒÉng
          icon.innerHTML = `
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
        d="M20.354 15.354A9 9 0 018.646 3.646
           9.003 9.003 0 0012 21
           a9.003 9.003 0 008.354-5.646z" />
    `;
        }
      }

      function toggleTheme() {
        const isLight = document.body.classList.contains("light-mode");
        setTheme(isLight ? "dark" : "light");
      }
      window.addEventListener("DOMContentLoaded", () => {
        const savedTheme = localStorage.getItem("theme") || "dark";
        setTheme(savedTheme);
      });
    </script>
  </body>
</html>
